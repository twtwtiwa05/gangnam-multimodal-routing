# 강남구 멀티모달 교통 라우팅 시스템

한국어 | [English](README_EN.md)

서울시 강남구의 대중교통(버스, 지하철)과 공유 모빌리티(자전거, 전동킥보드)를 완벽하게 통합한 고성능 사용자 맞춤형 멀티모달 교통 라우팅 시스템입니다.

## 목차

- [프로젝트 개요](#프로젝트-개요)
- [시스템 아키텍처](#시스템-아키텍처)
- [주요 기능](#주요-기능)
- [알고리즘 발전 과정](#알고리즘-발전-과정)
- [설치 및 실행](#설치-및-실행)
- [사용 예시](#사용-예시)
- [성능 지표](#성능-지표)
- [데이터 출처](#데이터-출처)
- [향후 과제](#향후-과제)

## 프로젝트 개요

### 문제 정의
서울 강남구의 도시 이동성은 여러 교통수단의 원활한 통합을 요구합니다. 기존 라우팅 시스템은 각 교통수단을 별도로 처리하여 최적화되지 않은 경로와 열악한 사용자 경험을 제공했습니다. 본 프로젝트는 통합 멀티모달 라우팅 알고리즘을 구현하여 이러한 문제를 해결합니다.

### 솔루션
모든 교통수단(버스, 지하철, 공공자전거, 전동킥보드)을 단일 네트워크의 일부로 처리하는 포괄적인 라우팅 시스템을 개발했습니다. 사용자 선호도에 적응하는 진정한 멀티모달 여정 계획이 가능합니다.

### 핵심 혁신
1. **통합 네트워크 모델**: 모든 교통수단을 단일 그래프 구조로 통합
2. **존 기반 라우팅**: 효율적인 모빌리티 옵션 탐색을 위한 30×30 그리드 시스템
3. **사용자 적응형 알고리즘**: 사용자 선호도에 따른 동적 경로 선택
4. **실제 데이터 통합**: 실제 GTFS 대중교통 데이터와 모빌리티 이용 패턴 활용

## 시스템 아키텍처

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                              데이터 파이프라인                               │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  원본 데이터                   처리 과정                  통합 시스템       │
│  ==========                   ==========                  ===========       │
│                                                                             │
│  GTFS 대중교통 ──┐          GTFSLOADER2.py                                 │
│  (2023년 3월)    ├────►     - BOM 인코딩 수정       ┌─────────────┐       │
│                  │          - 데이터 검증       ────►│             │       │
│  지하철 환승 ────┘          - 오류율 0.33%          │  PART1_2.py │       │
│  메타데이터                                         │             │       │
│                                                    │  구축:      │       │
│  서울 자전거    ─────►     process_ttareungee.py  │  - 정류장   │       │
│  대여소 (693개)            - 대여소 처리      ────►│  - 노선     │       │
│                           - 가용성 모델             │  - 운행     │       │
│                                                    │  - 환승     │       │
│  스윙 PM 데이터  ─────►     GangnamMobilityGen.py │             │       │
│  (9,591 주행)              - 수요 분석        ────►│             │       │
│                           - 그리드 클러스터링       └──────┬──────┘       │
│                           - 가상 정거장 생성               │              │
│                                                           │              │
│  OSM 도로망     ─────►     pkl/graphml로 캐시됨           │              │
│  (강남구 범위)            - 도로 거리 계산                 ▼              │
│                                                   raptor_data.pkl        │
│                                                           │              │
└───────────────────────────────────────────────────────────┼──────────────┘
                                                           │
┌──────────────────────────────────────────────────────────▼──────────────┐
│                           라우팅 알고리즘                                │
├──────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│  알고리즘 발전 과정:                                                     │
│                                                                          │
│  1. PART2_NEW (기본)           2. PART2_OTP           3. PART2_HYBRID   │
│     ===============               ==========              ============   │
│     전통적 RAPTOR                가상 정류장            존 기반         │
│     + 별도 모빌리티              접근법                 멀티모달       │
│     - O(n²) 복잡도              + 모든 수단을          + 적응형        │
│     - 10-20초 쿼리              정류장으로             라우팅         │
│     - 메모리 집약적              + O(n) 스캔            + OSM 경로      │
│                                 - 메모리 문제           + 사용자 선호   │
│                                 - 480배 빠름            + 효율적        │
│                                                                          │
└──────────────────────────────────────────────────────────────────────────┘
```

## 주요 기능

### 1. 멀티모달 통합
- **대중교통**: GTFS 데이터 기반 12,064개 정류장, 944개 노선
- **자전거 공유 (따릉이)**: 693개 대여소 실시간 가용성 모델링
- **전동킥보드**: 이용 패턴 기반 50개 가상 정거장에 500대 배치
- **도보**: 정확한 보행자 라우팅을 위한 OSM 기반 실제 도로 거리

### 2. 사용자 적응형 라우팅
사용자 개인의 선호도에 따라 조정 가능한 가중치 시스템:

```python
preference = RoutePreference(
    time_weight=0.4,        # 이동 시간 중요도
    transfer_weight=0.3,    # 환승 최소화
    walk_weight=0.2,        # 도보 거리 최소화
    cost_weight=0.1,        # 비용 효율성
    mobility_preference={
        'bike': 0.9,        # 자전거 강한 선호
        'kickboard': 0.4,   # 킥보드 낮은 선호
        'ebike': 0.7        # 전기자전거 보통 선호
    }
)
```

### 3. 존 기반 전략
출발지-목적지 거리에 따른 동적 라우팅 전략:

| 존 거리 | 전략 | 모빌리티 가중치 | 대중교통 가중치 |
|---------|------|----------------|----------------|
| 0 (같은 존) | 모빌리티만 | 100% | 0% |
| 1 (인접) | 모빌리티 우선 | 80% | 20% |
| 2 존 | 모빌리티 선호 | 70% | 30% |
| 3 존 | 균형 | 50% | 50% |
| 4 존 | 대중교통 선호 | 30% | 70% |
| 5+ 존 | 대중교통 우선 | 20% | 80% |

## 알고리즘 발전 과정

### 1단계: PART2_NEW (전통적 멀티모달 RAPTOR)
- **접근법**: 별도 모빌리티 검색을 사용하는 표준 RAPTOR
- **문제점**: 
  - 모빌리티 옵션에 대한 O(n²) 복잡도
  - 10-20초의 쿼리 시간
  - 메모리 집약적 (>1GB)
  - 여러 분기가 있는 복잡한 코드베이스

### 2단계: PART2_OTP (가상 정류장 혁신)
- **혁신**: 모든 모빌리티 옵션을 가상 대중교통 정류장으로 처리
- **장점**:
  - 480배 성능 향상 (0.02-0.04초 쿼리)
  - 통합 그래프 구조
  - 단순화된 알고리즘
- **한계**:
  - 대규모 데이터셋에서 메모리 폭발
  - 고정된 가상 경로로 유연성 부족

### 3단계: PART2_HYBRID (존 기반 적응형)
- **혁신**: Lazy evaluation을 사용한 30×30 존 그리드
- **장점**:
  - 거리 기반 적응형 라우팅
  - 사용자 선호도 통합
  - OSM 기반 실제 도로 거리
  - 메모리 효율적
  - 실시간 전략 조정

## 설치 및 실행

### 필수 요구사항
```bash
Python 3.8+
pip install pandas numpy networkx scipy
pip install osmnx folium shapely  # 선택사항이지만 권장
```

### 데이터 파이프라인 실행
```bash
# 1. GTFS 데이터 정리 및 준비
python GTFSLOADER2.py

# 2. 공유 모빌리티 가상 정거장 생성
python GangnamMobilityGenerator.py
# 차량 수를 입력하라는 메시지가 나타납니다 (예: 500)

# 3. RAPTOR 데이터 구조 구축
python PART1_2.py

# 4. 라우팅 시스템 실행
python PART2_HYBRID.py  # 권장
# 또는
python PART2_NEW.py     # 전통적 접근법
# 또는
python PART2_OTP.py     # 가상 정류장 접근법
```

## 사용 예시

### 기본 경로 쿼리
```python
from PART2_HYBRID import HybridZoneRAPTOR, RoutePreference, ZoneConfig

# 사용자 정의 구성으로 초기화
config = ZoneConfig()
config.mobility_only_threshold = 2  # 2 존 이내에서는 모빌리티만 사용
raptor = HybridZoneRAPTOR(config=config)

# 사용자 선호도 설정
preference = RoutePreference(
    time_weight=0.4,
    cost_weight=0.1,
    transfer_weight=0.3,
    walk_weight=0.2,
    max_walk_distance=800
)

# 경로 찾기
routes = raptor.find_routes(
    origin=(37.4979, 127.0276),      # 강남역
    destination=(37.5088, 127.0631),  # 삼성역
    departure_time="08:30",
    preference=preference
)
```

### 출력 예시
```
존 거리: 7, 전략: 대중교통 우선
모빌리티 가중치: 0.20, 대중교통 가중치: 0.80

찾은 경로: 3개

경로 1 (하이브리드, 전략: 대중교통 우선)
  총 시간: 10.2분
  총 비용: 1,370원
  환승: 0회
  도보: 150m
  구간:
    - 도보: 출발지 → 강남역 (2분)
    - 지하철 2호선: 강남 → 삼성 (6분)
    - 도보: 삼성역 → 목적지 (2.2분)

경로 2 (모빌리티만, 전략: 직접)
  총 시간: 15.3분
  총 비용: 3,200원
  환승: 0회
  도보: 0m
  구간:
    - 킥보드: 출발지 → 목적지 (15.3분, 4.2km)

경로 3 (하이브리드, 전략: 대중교통 우선)
  총 시간: 18.5분
  총 비용: 2,740원
  환승: 1회
  도보: 320m
  구간:
    - 도보: 출발지 → 버스 정류장 (3분)
    - 버스 146번: 강남 → 청담 (8분)
    - 도보: 환승 (2분)
    - 버스 3414번: 청담 → 삼성 (4분)
    - 도보: 버스 정류장 → 목적지 (1.5분)
```

## 성능 지표

### 쿼리 성능
| 알고리즘 | 평균 쿼리 시간 | 메모리 사용량 | 복잡도 |
|----------|---------------|--------------|---------|
| PART2_NEW | 10-20초 | ~1GB | O(n²m) |
| PART2_OTP | 0.02-0.04초 | ~2GB | O(nm) |
| PART2_HYBRID | 0.5-2초 | ~500MB | O(n log n) |

### 데이터 규모
- 대중교통 정류장: 12,064개 (강남 지역 9,404개)
- 대중교통 노선: 944개
- 예정된 운행: 44,634개
- 환승 연결: 45,406개
- 가상 PM 정거장: 50개 (500대 차량)
- 자전거 대여소: 693개
- OSM 도로망: 약 50,000개 노드

### 정확도 개선
- GTFS 데이터 오류율: 83%에서 0.33%로 감소
- 도보 거리: 직선 거리 × 1.3 대신 실제 도로 경로 사용
- 환승 횟수 계산: 실제 노선 변경만 계산하도록 수정

## 데이터 출처

1. **GTFS 대중교통 데이터** (2023년 3월)
   - 출처: 한국교통안전공단 (KTDB)
   - 범위: 서울특별시
   - 형식: 한국어 인코딩이 포함된 표준 GTFS

2. **서울시 자전거 대여소**
   - 출처: 서울 열린데이터 광장
   - 대여소: 강남구 693개
   - 업데이트: 실시간 가용성 모델

3. **스윙 PM 이용 데이터** (2023년 5월 10일)
   - 주행: 강남 지역 9,591건
   - 용도: 수요 기반 정거장 배치
   - 프라이버시: 익명화된 이동 데이터

4. **오픈스트리트맵 도로망**
   - 범위: 강남구 경계
   - 용도: 실제 도보/주행 거리
   - 형식: NetworkX 그래프 (pkl/graphml)

## 기술적 도전과 해결책

### 1. 지하철 2호선 순환 노선
- **도전**: 내선/외선 방향이 있는 순환 노선
- **해결**: PART1_2.py에서 패턴 감지 개선
- **상태**: 지선 처리를 위한 추가 개선 필요

### 2. 한국어 텍스트 인코딩
- **도전**: 혼합 인코딩 (BOM, UTF-8, CP949)
- **해결**: GTFSLOADER2.py에서 자동 인코딩 감지

### 3. 메모리 최적화
- **도전**: OTP 접근법이 2천만 개 이상의 시간표 항목 생성
- **해결**: HYBRID에서 존 기반 lazy evaluation

### 4. 실시간 적응성
- **도전**: 정적 사전 계산 vs 동적 선호도
- **해결**: 존 거리 기반 런타임 전략 선택

## 향후 과제

1. **실시간 통합**
   - 실시간 대중교통 업데이트
   - 동적 모빌리티 가용성
   - 교통 상황

2. **향상된 사용자 모델링**
   - 사용자 선택으로부터 학습
   - 개인화된 경로 추천
   - 상황 인식 제안

3. **지하철 2호선 개선**
   - 완전한 순환 노선 처리
   - 지선 통합
   - 급행 서비스 모델링

4. **확장성**
   - 서울 전체로 확장
   - 다중 도시 지원
   - 클라우드 배포

## 기여

이 프로젝트는 기여를 환영합니다. 주요 영역:
- 알고리즘 최적화
- 데이터 품질 개선
- UI/UX 개발
- 실시간 데이터 통합

## 라이선스

MIT 라이선스 - 자세한 내용은 LICENSE 파일 참조

## 감사의 말

- 한국교통안전공단(KTDB) - GTFS 데이터 제공
- 서울특별시 - 자전거 대여소 데이터 제공
- 스윙 - 익명화된 PM 이용 데이터 제공
- 오픈스트리트맵 기여자들

---

## 작성자 정보

**이름**: [이름을 입력하세요]  
**대학**: [대학명을 입력하세요]  
**학과**: [학과명을 입력하세요]  
**이메일**: [이메일을 입력하세요]  

**지도교수**: [지도교수명을 입력하세요] (선택사항)

---

**프로젝트 기간**: 2024년 11월 - 2024년 12월  
**연구 분야**: 멀티모달 교통, 도시 이동성, 알고리즘 최적화  
**키워드**: RAPTOR, 멀티모달 라우팅, 대중교통, 공유 모빌리티, 서울